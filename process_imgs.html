<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bulk Image Watermark</title>
</head>
<body>
    <h3>Bulk Image Watermark</h3>

    <form id="watermarkForm">
        <textarea name="image_urls" placeholder="https://example.com/image1.jpg" style="width:400px;height:150px;"></textarea><br><br>
        <button type="submit">Process Images</button>
    </form>

    <div id="resultsContainer" style="margin-top:20px;"></div>

<script>
document.getElementById('watermarkForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(this);

    const resultsDiv = document.getElementById('resultsContainer');
    resultsDiv.innerHTML = "⏳ Processing...";

    try {
        const response = await fetch('process_imgs.php', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data.error) {
            resultsDiv.innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
        }

        let html = `<table border="1" cellpadding="5">
            <tr><th>Image URL</th><th>Status</th><th>Original</th><th>Watermarked</th></tr>`;

        data.results.forEach(res => {
            html += `<tr>
                <td>${res.url}</td>
                <td>${res.status}</td>
                <td>${res.original ? `<a href="output/${encodeURIComponent(res.original)}" target="_blank">View</a>` : ''}</td>
                <td>${res.watermarked ? `<a href="output/${encodeURIComponent(res.watermarked)}" target="_blank">View</a>` : ''}</td>
            </tr>`;
        });

        html += '</table>';
        resultsDiv.innerHTML = html;

    } catch (err) {
        resultsDiv.innerHTML = `<p style="color:red;">❌ Error: ${err.message}</p>`;
    }
});
</script>

</body>
</html>
